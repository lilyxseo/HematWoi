import * as TablerIcons from "@tabler/icons-react";
import type { LucideIcon } from "lucide-react";
import {
  ArrowDown,
  ArrowUp,
  Banknote,
  BarChart3,
  Bell,
  BellRing,
  Calendar,
  CalendarDays,
  CalendarRange,
  ChartLine,
  Circle,
  CircleAlert,
  CircleDollarSign,
  DownloadCloud,
  EllipsisVertical,
  FileJson,
  FileUp,
  FolderKanban,
  Github,
  Globe2,
  Goal,
  HandCoins,
  Home,
  ImageDown,
  Info,
  Languages,
  Laptop,
  Layers3,
  LineChart,
  List,
  ListChecks,
  ListPlus,
  LogIn,
  LogOut,
  Monitor,
  MoonStar,
  MoreHorizontal,
  NotebookPen,
  Pencil,
  PieChart,
  PiggyBank,
  PlusCircle,
  Receipt,
  RefreshCcw,
  RefreshCw,
  Repeat,
  RotateCcw,
  Save,
  Settings,
  Shield,
  ShieldAlert,
  SlidersHorizontal,
  Tag,
  Target,
  TrendingUp,
  TriangleAlert,
  UploadCloud,
  User,
  UserRound,
  Wallet,
  Wallet2,
  Wand2,
  SunMedium,
  Trash2,
} from "lucide-react";

export const ICONS: Record<string, LucideIcon> = {
  home: Home,
  dashboard: Home,
  wallet: Wallet,
  wallets: Wallet,
  saving: PiggyBank,
  savings: PiggyBank,
  piggybank: PiggyBank,
  "piggy-bank": PiggyBank,
  piggy_bank: PiggyBank,
  budget: PiggyBank,
  budgets: PiggyBank,
  target: Target,
  goal: Target,
  goals: Target,
  tag: Tag,
  tags: Tag,
  label: Tag,
  labels: Tag,
  repeat: Repeat,
  recurring: Repeat,
  list: List,
  lists: List,
  tasks: List,
  checklist: List,
  chartline: ChartLine,
  chart: ChartLine,
  charts: ChartLine,
  analytics: ChartLine,
  analysis: ChartLine,
  graph: ChartLine,
  graphs: ChartLine,
  data: ChartLine,
  debt: ChartLine,
  debts: ChartLine,
  shield: Shield,
  security: Shield,
  protect: Shield,
  protection: Shield,
  settings: Settings,
  preference: Settings,
  preferences: Settings,
  config: Settings,
  configuration: Settings,
  user: User,
  users: User,
  profile: User,
  account: User,
  person: User,
  people: User,
  bell: Bell,
  notification: Bell,
  notifications: Bell,
  alert: Bell,
  alerts: Bell,
  reminder: Bell,
  reminders: Bell,
  subscription: Bell,
  subscriptions: Bell,
  piechart: PieChart,
  "pie-chart": PieChart,
  pie_chart: PieChart,
  calendar: Calendar,
  schedule: Calendar,
  date: Calendar,
  dates: Calendar,
  folderkanban: FolderKanban,
  "folder-kanban": FolderKanban,
  folder: FolderKanban,
  folders: FolderKanban,
  kanban: FolderKanban,
  board: FolderKanban,
  category: FolderKanban,
  categories: FolderKanban,
  project: FolderKanban,
  projects: FolderKanban,
  trendingup: TrendingUp,
  trending: TrendingUp,
  trend: TrendingUp,
  growth: TrendingUp,
  progress: TrendingUp,
  performance: TrendingUp,
  insight: TrendingUp,
  insights: TrendingUp,
  receipt: Receipt,
  receipts: Receipt,
  transaction: Receipt,
  transactions: Receipt,
  report: Receipt,
  reports: Receipt,
  invoice: Receipt,
  invoices: Receipt,
  statement: Receipt,
  'arrow-up': ArrowUp,
  arrowup: ArrowUp,
  arrow_up: ArrowUp,
  up: ArrowUp,
  'arrow-down': ArrowDown,
  arrowdown: ArrowDown,
  arrow_down: ArrowDown,
  down: ArrowDown,
  pencil: Pencil,
  edit: Pencil,
  pen: Pencil,
  trash: Trash2,
  delete: Trash2,
  remove: Trash2,
  banknote: Banknote,
  cash: Banknote,
  money: Banknote,
  budgetting: Banknote,
  'bar-chart': BarChart3,
  barchart: BarChart3,
  analyticsbar: BarChart3,
  bellring: BellRing,
  'bell-ring': BellRing,
  'calendar-days': CalendarDays,
  calendardays: CalendarDays,
  'calendar-range': CalendarRange,
  calendarrange: CalendarRange,
  circlealert: CircleAlert,
  'circle-alert': CircleAlert,
  circledollarsign: CircleDollarSign,
  'circle-dollar': CircleDollarSign,
  'circle-dollar-sign': CircleDollarSign,
  clouddownload: DownloadCloud,
  'cloud-download': DownloadCloud,
  ellipsis: EllipsisVertical,
  'ellipsis-vertical': EllipsisVertical,
  filejson: FileJson,
  'file-json': FileJson,
  fileupload: FileUp,
  'file-up': FileUp,
  github: Github,
  'brand-github': Github,
  globe2: Globe2,
  world: Globe2,
  goalicon: Goal,
  vision: Goal,
  'hand-coins': HandCoins,
  handcoins: HandCoins,
  imagedown: ImageDown,
  'image-down': ImageDown,
  info: Info,
  information: Info,
  languages: Languages,
  translate: Languages,
  laptop: Laptop,
  computer: Laptop,
  layers3: Layers3,
  layers: Layers3,
  linechart: LineChart,
  'line-chart': LineChart,
  listchecks: ListChecks,
  'list-checks': ListChecks,
  listplus: ListPlus,
  'list-plus': ListPlus,
  login: LogIn,
  signin: LogIn,
  logout: LogOut,
  signout: LogOut,
  monitor: Monitor,
  desktop: Monitor,
  moonstar: MoonStar,
  'moon-star': MoonStar,
  more: MoreHorizontal,
  morehorizontal: MoreHorizontal,
  notebook: NotebookPen,
  notes: NotebookPen,
  pluscircle: PlusCircle,
  'plus-circle': PlusCircle,
  refresh: RefreshCw,
  refreshccw: RefreshCcw,
  refreshcw: RefreshCw,
  rotate: RotateCcw,
  save: Save,
  downloadsave: Save,
  shieldalert: ShieldAlert,
  'shield-alert': ShieldAlert,
  sliders: SlidersHorizontal,
  'sliders-horizontal': SlidersHorizontal,
  sunmedium: SunMedium,
  'sun-medium': SunMedium,
  trianglealert: TriangleAlert,
  'triangle-alert': TriangleAlert,
  uploadcloud: UploadCloud,
  'upload-cloud': UploadCloud,
  userround: UserRound,
  'user-round': UserRound,
  wallet2: Wallet2,
  'wallet-2': Wallet2,
  wand2: Wand2,
  'wand-2': Wand2,
};

export const ICON_NAMES = Object.keys(ICONS).sort((a, b) => a.localeCompare(b));

interface IconProps {
  name?: string | null;
  className?: string;
  label?: string;
}

export function Icon({ name, className, label }: IconProps) {
  const trimmed = typeof name === "string" ? name.trim() : "";
  const normalized = trimmed.toLowerCase();
  const IconComponent =
    (normalized ? ICONS[normalized] : undefined) ??
    (trimmed ? resolveTablerIcon(trimmed) : undefined) ??
    Circle;

  return (
    <IconComponent
      aria-label={label ?? (normalized || "icon")}
      className={className ?? "w-5 h-5"}
    />
  );
}

const TABLER_ICON_REGISTRY = TablerIcons as Record<string, LucideIcon | undefined>;
const tablerCache = new Map<string, LucideIcon | null>();

function resolveTablerIcon(source: string): LucideIcon | null {
  if (tablerCache.has(source)) {
    return tablerCache.get(source) ?? null;
  }

  const candidates = generateTablerCandidates(source);
  for (const candidate of candidates) {
    const component = TABLER_ICON_REGISTRY[candidate];
    if (component) {
      tablerCache.set(source, component as LucideIcon);
      return component as LucideIcon;
    }
  }

  tablerCache.set(source, null);
  return null;
}

function generateTablerCandidates(raw: string): string[] {
  const trimmed = raw.trim();
  if (!trimmed) return [];

  const candidates = new Set<string>();
  if (/^icon[a-z0-9]/i.test(trimmed)) {
    candidates.add(trimmed);
    candidates.add(`Icon${trimmed.replace(/^icon/i, "")}`);
  }

  const spaced = trimmed
    .replace(/^icon/i, "")
    .replace(/([a-z])([A-Z])/g, "$1 $2")
    .replace(/[^a-zA-Z0-9]+/g, " ")
    .split(" ")
    .filter(Boolean)
    .map((part) => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
    .join("");

  if (spaced) {
    candidates.add(`Icon${spaced}`);
  }

  return Array.from(candidates);
}
